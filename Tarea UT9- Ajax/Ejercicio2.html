<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicio2</title>
    <style>
        #contenedor {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
        }

        #form {
            border: 1px solid black;
            padding: 20px;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div id="contenedor">
        <div id="form">
            <form>
                <h1>PRODUCTOS</h1>
                <label for="nombre">Nombre:</label>
                <select name="nombre" id="nombre"></select><br>

                <label for="precio">Precio:</label>
                <input type="number" step="0.01" min="0.01" name="precioMin" id="precio1"></br>
                <input type="number" step="0.01" min="precioMin" name="precioMax" id="precio2"></br>

                <label for="categorias">Categoria:</label>
                <select name="categorias" id="categorias"></select><br><br>

                <button id="postProducts">Buscar</button>
            </form>
        </div>
        <div id="form">
            <form>
                <h1>CATEGORÍAS</h1>
                <label for="nombre">Nombre:</label>
                <input type="text" name="nombre" id="nombreCategoria" pattern="[a-zA-Z]+" required></br>

                <label for="descripcion">Descripcion:</label>
                <input type="text" name="descripcion" id="descripcionCategoria" pattern="[a-zA-Z]+" required></br><br>

                <button id="postCategories">Insertar</button>
            </form>
        </div>
    </div>
    <script>
        const SERVER = 'http://localhost:3000'
        new Promise(function (resolve, reject) {
            let peticion = new XMLHttpRequest()
            peticion.open('GET', SERVER + '/categories');
            peticion.send()

            peticion.addEventListener('load', () => {
                if (peticion.status === 200) {
                    const data = JSON.parse(peticion.response)
                    const getNombres = document.getElementById('categorias');
                    let opt;

                    for (i = 0; i < data.length; i++) {
                        if (data[i]['name'] != '') {
                            opt = document.createElement("option");
                            opt.innerHTML = data[i]['name'].toUpperCase();
                            opt.value = data[i]['id'];
                            getNombres.appendChild(opt);
                        }
                    }
                } else {
                    reject("Error " + this.status + " (" + this.statusText + ") en lapetición")
                }
            })
            peticion.addEventListener('error', () => reject('Error en la petición HTTP'))
        })

        document.getElementById('nombre').addEventListener('click', function () {
            new Promise(function (resolve, reject) {
                let peticion = new XMLHttpRequest()
                peticion.open('GET', SERVER + '/products');
                peticion.send()

                peticion.addEventListener('load', () => {
                    if (peticion.status === 200) {
                        const data = JSON.parse(peticion.response)
                        const getNombres = document.getElementById('nombre');
                        for (i = 0; i < getNombres.length; i++) {
                            getNombres.removeChild(i);
                        }
                        let opt;

                        for (i = 0; i < data.length; i++) {
                            if (data[i]['name'] != '') {
                                opt = document.createElement("option");
                                opt.innerHTML = data[i]['name'].toUpperCase();
                                opt.value = data[i]['name'];
                                opt.className = 'options';
                                getNombres.appendChild(opt);
                            }
                        }

                    } else {
                        reject("Error " + this.status + " (" + this.statusText + ") en lapetición")
                    }
                })
                peticion.addEventListener('error', () => reject('Error en la petición HTTP'))
            })
        })

        document.getElementById('nombre').addEventListener('click', function () {
            new Promise(function (resolve, reject) {
                let peticion = new XMLHttpRequest()
                peticion.open('GET', SERVER + '/products');
                peticion.send()

                peticion.addEventListener('load', () => {
                    if (peticion.status === 200) {
                        const data = JSON.parse(peticion.response)
                        const getNombres = document.getElementById('nombre');
                        for (i = 0; i < getNombres.length; i++) {
                            getNombres.removeChild(i);
                        }
                        let opt;

                        for (i = 0; i < data.length; i++) {
                            if (data[i]['name'] != '') {
                                opt = document.createElement("option");
                                opt.innerHTML = data[i]['name'].toUpperCase();
                                opt.value = data[i]['name'];
                                opt.className = 'options';
                                getNombres.appendChild(opt);
                            }
                        }

                    } else {
                        reject("Error " + this.status + " (" + this.statusText + ") en lapetición")
                    }
                })
                peticion.addEventListener('error', () => reject('Error en la petición HTTP'))
            })
        })
    </script>
</body>

</html>