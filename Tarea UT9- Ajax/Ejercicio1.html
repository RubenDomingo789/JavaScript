<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #contenedor {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }
    </style>
</head>

<body>
    <div id="contenedor">
        <div>
            <form>
                <h1>PRODUCTOS</h1>
                <label for="nombre">Nombre:</label>
                <input type="text" name="nombre" id="nombre" pattern="[a-zA-Z]+" required></br>

                <label for="precio">Precio:</label>
                <input type="number" step="0.01" name="precio" id="precio" required></br>

                <label for="descripcion">Descripcion:</label>
                <input type="text" name="descripcion" id="descripcion" pattern="[a-zA-Z]+" required></br>

                <label for="categorias">Categoria:</label>
                <select name="categorias" id="categorias" required></select><br>

                <button id="postProducts">Insertar</button>
            </form>
        </div>
        <div>
            <form>
                <h1>CATEGOR√çAS</h1>
                <label for="nombre">Nombre:</label>
                <input type="text" name="nombre" id="nombre" pattern="[a-zA-Z]+" required></br>

                <label for="descripcion">Descripcion:</label>
                <input type="text" name="descripcion" id="descripcion" pattern="[a-zA-Z]+" required></br>

                <button id="postCategories">Insertar</button>
            </form>
        </div>
    </div>
    <script>
        const peticion = new XMLHttpRequest();
        peticion.open('GET', 'http://localhost:3000/categories');

        peticion.onload = () => {
            const data = JSON.parse(peticion.response);
            const getCategorias = document.getElementById('categorias');
            let opt;

            for (i = 0; i < data.length; i++) {
                if (data[i]['name'] != '') {
                    opt = document.createElement("option");
                    opt.innerHTML = data[i]['name'].toUpperCase();
                    opt.value = data[i]['name'];
                    getCategorias.appendChild(opt);
                }
            }
        };
        peticion.send();

        //Botones insertar
        let nombre = document.getElementById('nombre');
        let price = document.getElementById('precio');
        let description = document.getElementById('descripcion');
        let categoryId = document.getElementById('categorias');

        const sendProducts = () => {
            peticion.open('POST', 'http://localhost:3000/products');

            peticion.setRequestHeader('Content-Type', 'application/json');

            peticion.onload = () => {
                const data = JSON.parse(peticion.response);
            };
            if (nombre.checkValidity() == true && price.checkValidity() == true && description.checkValidity()) {
                peticion.send(JSON.stringify({
                    name: nombre.value,
                    price: price.value,
                    description: description.value,
                    categoryId: categoryId.value
                }));
            }
        };

        postProducts.addEventListener('click', sendProducts);
        
    </script>
</body>

</html>